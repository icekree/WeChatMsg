# WeChatMsg 微信聊天记录导出工具 - 运行指南

## 项目概述

WeChatMsg 是一个用于导出微信聊天记录的Python工具，支持：
- 微信3.x和4.0版本
- 多种导出格式（HTML、TXT、CSV、Word、Excel、JSON等）
- 聊天记录解密和数据库访问
- 联系人信息导出
- AI聊天功能

## 系统要求

- Windows 10/11
- Python 3.10+
- 管理员权限（用于访问微信进程内存）
- 正在运行的微信客户端

## 安装步骤

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

主要依赖包括：
- protobuf (处理微信数据格式)
- pandas, numpy (数据处理)
- openpyxl, python-docx (文档导出)
- psutil, pymem (进程和内存访问)
- pycryptodome (加密解密)
- 其他辅助工具包

### 2. 确保微信正在运行

在运行解密工具前，请确保微信客户端正在运行。

## 使用流程

### 第一步：解密微信数据库

```bash
# 使用原始脚本
python example/1-decrypt.py

# 或使用简化版本（推荐）
python simple_decrypt.py
```

这一步会：
1. 扫描正在运行的微信进程
2. 获取微信用户信息和解密密钥
3. 解密微信数据库文件
4. 在项目目录下创建 `{微信号}/Msg/` 文件夹

**输出示例：**
```
找到微信实例:
用户: KREE
微信号: icekree
版本: 3.9.12.51
数据目录: E:\Users\Administrator\Documents\WeChat Files\icekree
解密密钥: 4d5500d7cd67438db66f5cb4cfd87de41cc761499e494851ad9999f29888704b
```

### 第二步：查看联系人信息

```bash
python example/2-contact.py
```

这一步会显示：
- 所有联系人列表
- 群聊信息和成员
- 联系人头像等信息

### 第三步：导出聊天记录

```bash
python example/3-exporter.py
```

支持的导出格式：
- **HTML**: 还原微信聊天界面，支持图片、视频、语音等
- **TXT**: 纯文本格式
- **CSV**: 表格格式，便于数据分析
- **Word**: 文档格式
- **Excel**: 表格格式
- **JSON**: 结构化数据格式
- **Markdown**: Markdown格式

## 项目结构

```
WeChatMsg/
├── wxManager/          # 核心微信数据处理模块
│   ├── decrypt/        # 解密相关功能
│   ├── db_v3/         # 微信3.x数据库处理
│   ├── db_v4/         # 微信4.0数据库处理
│   └── parser/        # 消息解析器
├── exporter/          # 导出功能模块
├── example/           # 使用示例
├── MemoAI/           # AI聊天功能
└── doc/              # 文档
```

## 常见问题和解决方案

### 1. 权限问题
**问题**: 无法访问微信进程或解密失败
**解决**: 以管理员身份运行PowerShell/命令提示符

### 2. 找不到微信进程
**问题**: 提示"未找到微信进程"
**解决**: 
- 确保微信客户端正在运行
- 检查微信版本是否支持（3.x或4.0）
- 重启微信客户端

### 3. 模块导入错误
**问题**: `ModuleNotFoundError: No module named 'wxManager'`
**解决**: 确保在项目根目录运行脚本，或设置PYTHONPATH

### 4. 解密密钥获取失败
**问题**: 无法获取解密密钥
**解决**: 
- 以管理员权限运行
- 确保微信版本在支持列表中
- 重启微信和电脑

### 5. 数据库文件损坏
**问题**: 解密后的数据库无法打开
**解决**: 
- 重新运行解密过程
- 检查微信数据目录权限
- 确保微信完全关闭后再解密

## 高级功能

### AI聊天功能
```bash
cd MemoAI
python api_server.py
```

### 自定义导出
修改 `example/3-exporter.py` 中的参数：
- `message_types`: 指定导出的消息类型
- `time_range`: 指定时间范围
- `group_members`: 指定群聊成员

## 注意事项

1. **法律合规**: 仅用于导出自己的聊天记录，禁止用于非法用途
2. **数据安全**: 解密后的数据库包含敏感信息，请妥善保管
3. **版本兼容**: 主要支持微信3.x和4.0版本
4. **系统兼容**: 目前仅支持Windows系统
5. **备份建议**: 运行前建议备份微信数据

## 技术支持

- GitHub: https://github.com/LC044/WeChatMsg
- 文档: https://memotrace.cn/doc/
- 问题反馈: 提交GitHub Issue

## 更新日志

- v3.0: 支持微信4.0，全新UI，重构底层逻辑
- 更快的导出速度，更低的内存占用
- 前后端分离架构